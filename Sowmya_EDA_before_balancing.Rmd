---
title: "Sowmya_EDA - Before balancing the dataset"
author: "Sowmya"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# importing the ezids package
library(ezids)

# importing ggplot2 for graphs
library(ggplot2)
library(gridExtra)


loadPkg("corrplot")
```

# Brain Stroke Prediction

```{r}
stroke_df = read.csv("healthcare-dataset-stroke-data.csv")
stroke_df = subset(stroke_df, select = -c(id))
xkabledplyhead(stroke_df)

# Getting the summary of the dataframe
summary(stroke_df)


# Looking at the structure of the Dataframe
str(stroke_df)
```
There are a total of 5110 observations present in the dataset with 11 variables.
The target variable is called stroke.

```{r}
# changing the variables to categorical variables and numerical variables
stroke_df$gender <- as.factor(stroke_df$gender)
stroke_df$hypertension <- as.factor(stroke_df$hypertension)
stroke_df$heart_disease <- as.factor(stroke_df$heart_disease)
stroke_df$ever_married <- as.factor(stroke_df$ever_married)
stroke_df$bmi <- as.numeric(stroke_df$bmi)
stroke_df$stroke<- as.factor(stroke_df$stroke)
#str(stroke_df)

# Finding if there are any NA's in the dataset
paste("The NA's in the dataset is:",sum(is.na(stroke_df)))
xkablesummary(stroke_df)
```
The NA values are present in the feature BMI. 
As for hypertension and heart_disease there are no missing values and the two features are converted to factors with 2 levels each that is 0, and 1

```{r}
df<-table(stroke_df$stroke)
barplot(df,main='Distribution of Target Variable (Stroke)',col=c('blue','red'))
```
Providing a bar graph to depicit the target variable, in this case the name of the target variable is "stroke".
Looking at the graph it is obvious that the dataset is imbalanced due to the rease that majority of the data points result in "not a stroke" then having a "stroke".

```{r}
set.seed(123)
ind <- sample(2, nrow(stroke_df), replace = TRUE, prob = c(0.6, 0.4))
train <- stroke_df[ind==1,]
test <- stroke_df[ind==2,]
table(stroke_df$stroke)
```

```{r}
#install.packages("ROSE")
```

```{r}
# UNDER AND OVER SAMPLING - BOTH
library(ROSE)
both <- ovun.sample(stroke~., data=train, method = "both",
                    p = 0.5,
                    seed = 222,
                    N = 5110)$data  # trying for the whole data set observations
r<-table(both$stroke)
r
```
Using "ROSE" package to do under & over sampling such that the data set will be balanced.

```{r}
# UNDER AND OVER SAMPLING TECHNIQUE
barplot(r,col='green')
```

```{r}
#UNDER
un <- ovun.sample(stroke~., data=train, method = "under")$data
u<-table(un$stroke)
u
barplot(u,col='yellow')
```

```{r}
#Over sampling
ov <- ovun.sample(stroke~., data=train, method = "over")$data
o<-table(ov$stroke)
o
barplot(o,col='red')
```

```{r}
ht=table(stroke_df$stroke,stroke_df$hypertension)
barplot(ht,
main = "People segregated based on hypertension",
xlab = "hypertension",
ylab = "Number of people",
col = c("Green","red"),
beside = TRUE
)
```

From the barplot above we can see people with no hypertension (0) has no stroke (0) and people with hypertension (1) have a slight chance of getting a stroke (1)

```{r}
# Comparing hypertension type with stroke 
ht_tab = table(stroke_df$hypertension, stroke_df$stroke)
names(dimnames(ht_tab))<- c("Hypertension", "Stroke")
ht_tab
```
Using this table we can better analyse what we have seen in the barplot above.
When hypertension is 0 (i.e., no hypertension) then there are 4429 people with no stroke and 183 with stroke, and when hypertension is 1 (i.e., hypertension is present) then there are 432 people who had no stroke, and 66 people with stroke.

```{r}
hd=table(stroke_df$stroke,stroke_df$heart_disease)
barplot(hd,
main = "People segregated based on heart disease",
xlab = "heart_disease",
ylab = "Number of people",
col = c("Green","red"),
beside = TRUE
)
```

From the above barplot we can see that if a person has not suffered with a heart disease before then chances of them getting a stroke is minimal and if they did suffer a stroke before then there is a possibility of getting a stroke (but chances are minimal)

```{r}
# Comparing heart disease type with stroke 
hd_tab = table(stroke_df$heart_disease, stroke_df$stroke)
names(dimnames(hd_tab))<- c("heart_disease", "Stroke")
hd_tab
```

From the above table we can conclude what we did in the barplot before. There are a total of 4632 people who didn't suffer a stroke before and there are 202 people who did not have a stroke before but did have stroke later. On the other hand, there are 229 people who previously suffered with a stroke but not later, and 47 who suffered with a stroke before and later as well.

```{r}
set.seed(123)
ind <- sample(2, nrow(stroke_df), replace = TRUE, prob = c(0.7, 0.3))
train <- stroke_df[ind==1,]
test <- stroke_df[ind==2,]
table(train$stroke)
```

```{r}
# Converting hypertension & heart_disease into numeric to conduct tests
stroke_df$hypertension <- as.numeric(factor(stroke_df$hypertension))
xkabledplyhead(stroke_df)

stroke_df$heart_disease <- as.numeric(factor(stroke_df$heart_disease))
xkabledplyhead(stroke_df)
```

```{r}
# Checking Test of Independence between hypertension and Target Variable Stroke
#alpha =0.05
ht_ch<-table(stroke_df$hypertension, stroke_df$stroke)  
chisq.test(stroke_df$hypertension, stroke_df$stroke)

# Checking Test of Independence between heart_disease and Target Variable Stroke
#alpha =0.05
hd_ch<-table(stroke_df$heart_disease, stroke_df$stroke)  
chisq.test(stroke_df$heart_disease, stroke_df$stroke)
```
