---
title: "Brain Stroke Prediction"
author: "Team Sage"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---


Brain Stroke:

A stroke is a medical condition in which poor blood flow to the brain causes cell death. According to the World Health Organization (WHO) stroke is the 2nd leading cause of death globally, responsible for approximately 11% of total deaths.

Dataset Link: https://www.kaggle.com/datasets/fedesoriano/stroke-prediction-dataset
```{r}
library(ggplot2)
library(corrplot)
library(ROSE)
```

```{r}
stroke_df = read.csv("healthcare-dataset-stroke-data.csv")
stroke_df = subset(stroke_df, select = -c(id))
head(stroke_df)
# Getting the summary of the dataframe
summary(stroke_df)
# Looking at the structure of the Dataframe
str(stroke_df)
```
```{r}
# changing the variables to categorical variables and numerical variables
stroke_df$gender = as.factor(stroke_df$gender)
stroke_df$hypertension = as.factor(stroke_df$hypertension)
stroke_df$heart_disease = as.factor(stroke_df$heart_disease)
stroke_df$ever_married = as.factor(stroke_df$ever_married)
stroke_df$bmi = as.numeric(stroke_df$bmi)
stroke_df$stroke = as.factor(stroke_df$stroke)
stroke_df$work_type = as.factor(stroke_df$work_type)
stroke_df$ever_married = as.factor(stroke_df$ever_married)
stroke_df$smoking_status = as.factor(stroke_df$smoking_status)
stroke_df$Residence_type = as.factor(stroke_df$Residence_type)
#str(stroke_df)
# Finding if there are any NA's in the dataset
#paste("The NA's in the dataset is:",sum(is.na(stroke_df)))
summary(stroke_df)
```
```{r}
# There are 201 NA's in BMI. Replacing those variables with mean of BMI
stroke_df$bmi[is.na(stroke_df$bmi)] = mean(stroke_df$bmi,na.rm = TRUE)
# Finding if there are any NA's after imputation of null values
paste("The NA's in the dataset is:",sum(is.na(stroke_df)))
```

```{r}
ggplot(stroke_df, aes(x=stroke,fill=stroke))+geom_bar()+ggtitle("Distribution of Target variable(Stroke)")+ theme_bw() +  theme()+ xlab("Stroke") + ylab("Count of people")
```


Since the Data is imbalanced we are using sampling techniques such as under sampling and over sampling. In this case we used both under and over sampling 
```{r}
# we are first splitting the data into test and train 
set.seed(123)
ind <- sample(2, nrow(stroke_df), replace = TRUE, prob = c(0.7, 0.3))
train <- stroke_df[ind==1,]
test <- stroke_df[ind==2,]
# In the train data we are using under and oversampling to address the class imbalance problem
both <- ovun.sample(stroke~., data=train, method = "both",
                    p = 0.5,
                    seed = 222,
                    N = 5110)$data
r<-table(both$stroke)
paste("Seeing if the class imabalance is fixed")
r
# copying this data frame to a new dataframe
stroke_df_train_sample = both
str(stroke_df_train_sample)
# Looking at the Information in the dataset after sampling 
summary(both)
stroke_df
```
```{r}
ggplot(stroke_df, aes(x=stroke,fill=stroke))+geom_bar()+ggtitle("Distribution of Target variable after sampling")+ theme_bw() +  theme()+ xlab("Stroke") + ylab("Count of people")
```

```{r}

ggplot(stroke_df, aes(x=smoking_status,fill=stroke))+geom_bar(position = "dodge")+ggtitle("People segregated based on their smoking habbits")+ theme_bw() +  theme()+ xlab("Smoking status") + ylab("Number of people")
```

```{r}
df = subset(stroke_df, stroke_df$work_type == "Private" | stroke_df$work_type == "Self-employed" )
df

# Count of Males and Females in the Dataset
ggplot(stroke_df, aes(x=gender,fill=gender))+geom_bar()+ggtitle("Count of Male and Female in the Dataset")+ theme_bw() +
  theme()+ xlab("Gender") + ylab("Count of people")
# Seeing if work type affects people
ggplot(stroke_df,aes(x=work_type, fill=stroke))+geom_bar(position = "dodge")+ggtitle("Work Type Vs Stroke")+ theme_bw() +
  theme()+ xlab("Work Type") + ylab("Count of people who had a stroke")
# Seeing if Smoking status causes stroke
ggplot(stroke_df,aes(x=work_type, fill= smoking_status))+geom_bar(position = "dodge")+ggtitle("Smoking habbits in different work types")+ theme_bw() + theme()+ xlab("Work Type") + ylab("Count of people ")

#ggplot(df,aes(x=work_type, fill=stroke))+geom_bar(position = "dodge")+ggtitle("Work Type Vs Stroke")+ theme_bw() +
#  theme()+ xlab("Work Type") + ylab("Count of people who had a stroke")
```

```{r}
# Bmi distribution
ggplot( stroke_df,aes(x=bmi)) + geom_density(fill="#69b3a2", color="#e9ecef", alpha=0.8)+ theme_bw() + theme()+ ggtitle("BMI distribution")
# BMI vs stroke 
ggplot(stroke_df, aes(x=bmi, fill=stroke)) + geom_histogram( color="#e9ecef", alpha=0.6, position = 'identity')+ theme_bw() + theme()

ggplot(stroke_df, aes(x=avg_glucose_level)) +  geom_density(fill="#69b3a2", color="#e9ecef", alpha=0.8)+ theme_bw() + theme()
```

```{r}
# checking if any variables are related
stroke_numeric = subset(stroke_df, select = c(age,avg_glucose_level,bmi))
corr_matrix = cor(stroke_numeric)
corrplot(corr_matrix, method = "number", type = "upper")

```

```{r}
stroke_1 = subset(stroke_df, stroke == 1)
stroke_0 = subset(stroke_df, stroke == 0)


ggplot(stroke_1, aes(x = age, fill=stroke))+ geom_density(alpha = 0.3)+ ggtitle("Density plot for age of people who had stroke")
# how bmi and age is stroke in people 
ggplot(stroke_1, aes(x=bmi, y=age, color=stroke))+geom_point(size=3)+ ggtitle("Scatter plot for age vs bmi for people who had a stroke")
#ggplot(stroke_0, aes(x=bmi, y=age, color=stroke))+geom_point(size=3)
ggplot(stroke_1, aes(x=bmi, y=age, color=stroke))+geom_boxplot()
ggplot(stroke_0, aes(x=bmi, y=age, color=stroke))+geom_boxplot()
ggplot(stroke_1, aes(x=age, y=bmi, color=stroke))+geom_boxplot()
ggplot(stroke_0, aes(x=age, y=bmi, color=stroke))+geom_boxplot()
ggplot(stroke_1, aes(x=age, y=avg_glucose_level, color=stroke))+geom_boxplot()
ggplot(stroke_0, aes(x=age, y=avg_glucose_level, color=stroke))+geom_boxplot()
ggplot(stroke_1, aes(y=age, x=hypertension, color=stroke))+geom_boxplot()

# we can see 25 % to 75 % who get stroke are from age 58 - 78 . the higher the age the chances of getting a stroke is more
# we can see become who have bmi from 27.5 to 32.5 have higher chances of stroke

```
```{r}
stroke_1_female = subset(stroke_df, stroke == 1 & gender == "Female")
stroke_1_male = subset(stroke_df, stroke == 1 & gender == "Male")

ggplot(stroke_1,aes(x=work_type, fill= smoking_status))+geom_bar(position = "dodge")+ggtitle("Distribution of people who had a stroke based on their smoking habits(irrelevant of gender)")+ theme_bw() + theme()+ xlab("Work Type") + ylab("Count of people ")
ggplot(stroke_1_female,aes(x=work_type, fill= smoking_status))+geom_bar(position = "dodge")+ggtitle("Distribution of females who had a stroke based on their smoking habits")+ theme_bw() + theme()+ xlab("Work Type") + ylab("Count of people ")
ggplot(stroke_1_male,aes(x=work_type, fill= smoking_status))+geom_bar(position = "dodge")+ggtitle("Distribution of males who had a stroke based on their smoking habits")+ theme_bw() + theme()+ xlab("Work Type") + ylab("Count of people ")
```
categories are encoded as:

If your BMI is less than 18.5, it falls within the underweight range.
If your BMI is 18.5 to <25, it falls within the normal.
If your BMI is 25.0 to <30, it falls within the overweight range.
If your BMI is 30.0 or higher, it falls within the obesity range.
If BMI is 40 or higher, it is considered to be "extreme" or severe obesity.


```{r}
dat <- within(stroke_df, {   
  bmi.cat <- NA # need to initialize variable
  bmi.cat[bmi < 18.5] <- "underweight"
  bmi.cat[bmi >= 18.5 & bmi < 25] <- "normal"
  bmi.cat[bmi >= 25 & bmi < 30] <- "overweight"
  bmi.cat[bmi >= 30 & bmi < 40] <- "obesity"
  bmi.cat[bmi >=40] <- "severe obesity" 
  avg_gluc.cat <- NA # need to initialize variable
  avg_gluc.cat[avg_glucose_level < 60] <- "Below 60"
  avg_gluc.cat[avg_glucose_level >= 60 & avg_glucose_level < 90] <- "60 - 90"
  avg_gluc.cat[avg_glucose_level >= 90 & avg_glucose_level < 140] <- "90 - 140"
  avg_gluc.cat[avg_glucose_level >= 140 & avg_glucose_level < 273] <- "140 - 273" 
   } )

dat$bmi.cat<- factor(dat$bmi.cat,levels= c("underweight","normal","overweight","obesity","severe obesity" ))
dat$avg_gluc.cat<- factor(dat$avg_gluc.cat,levels= c("Below 60","60 - 90","90 - 140","140 - 273" ))
str(dat)


ggplot(dat,aes(x= bmi.cat, fill=stroke))+geom_bar(position = "dodge")+ggtitle("BMI Vs Stroke")+ theme_bw() +
  theme()+ xlab("BMI index") + ylab("Count of people who had a stroke")

ggplot(dat, aes(x=bmi.cat,y = age, fill=stroke))+geom_boxplot()+ ggtitle("Boxplot for Age vs BMI(categorical)")

dat_stroke_1 = subset(dat, stroke ==1)

ggplot(dat_stroke_1,aes(x= avg_gluc.cat, fill=stroke))+geom_bar(position = "dodge")+ggtitle("Avg Gulcose level Vs Stroke")+ theme_bw() +
  theme()+ xlab("Avg Glucose level") + ylab("Count of people who had a stroke")
#dist of glucose by work type
ggplot(dat_stroke_1,aes(y=avg_glucose_level , fill=work_type))+geom_boxplot()+ggtitle("Avg Gulcose level Vs Stroke")+ theme_bw() +
  theme()+ xlab("Work Type") + ylab("Avg Glucose Level")
# we can see 25 % to 75 % who get stroke are from age 58 - 78 . the higher the age the chances of getting a stroke is more
# we can see become who have bmi from 27.5 to 32.5 have higher chances of stroke
```

```{r}
stroke_1_dat = subset(dat, stroke==1 )
ggplot(stroke_1_dat, aes(fill=stroke, y = age, x = avg_gluc.cat))+ geom_boxplot()+ ggtitle("Boxplot for Age vs Average Gluclose level(Categorical) for people with stroke")
```
```{r}

gender_unkown = subset(dat, gender!= "Unknown")
smoke_wt_unkown = subset(dat, smoking_status!= "Unknown")

ctest = chisq.test(as.factor(dat$ever_married), dat$stroke)
ctest
ctest1 = chisq.test(as.factor(dat$work_type), dat$stroke)
ctest1
ctest2 = chisq.test(as.factor(smoke_wt_unkown$smoking_status), smoke_wt_unkown$stroke)
ctest2
ctest3 = chisq.test(as.factor(gender_unkown$gender), gender_unkown$stroke)
ctest3
```

The pvalue of this test is <0.05 so we fail to reject the null hypothesis. That is these two variables smoking status and stroke are related.

```{r}
ctest1 = chisq.test(stroke_df$work_type, stroke_df$stroke,simulate.p.value = 0)
ctest1
```

The pvalue of this test is <0.05 so we fail to accept the null hypothesis. That is these two variables work type and stroke are related.
